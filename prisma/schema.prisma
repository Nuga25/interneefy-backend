generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url       = env("DATABASE_URL")
}

// --- Company Model ---
model Company {
  id          Int          @id @default(autoincrement())
  name        String
  logoUrl     String?
  createdAt   DateTime     @default(now())
  users       User[]
  tasks       Task[]
  evaluations Evaluation[]
}

// --- User Model (Updated for Supervision + Intern Fields) ---
model User {
  id                Int          @id @default(autoincrement())
  fullName          String
  email             String       @unique
  password          String
  role              Role
  domain            String?      @default("General") // NEW: e.g., "Software Engineering"
  startDate         DateTime?    // NEW: Internship start date
  endDate           DateTime?    // NEW: Internship end date
  createdAt         DateTime     @default(now())
  company           Company      @relation(fields: [companyId], references: [id])
  companyId         Int

  // Supervision relationship (Self-referencing)
  supervisees       User[]       @relation("Supervision")
  supervisor        User?        @relation("Supervision", fields: [supervisorId], references: [id])
  supervisorId      Int?

  tasksAsSupervisor Task[] @relation("SupervisorTasks")
  tasksAsIntern     Task[] @relation("InternTasks")
  evalsAsSupervisor Evaluation[] @relation("SupervisorEvals")
  evalsAsIntern     Evaluation[] @relation("InternEvals")
}

// --- Task Model (Finalized: No time tracking fields) ---
model Task {
  id               Int        @id @default(autoincrement())
  title            String
  description      String?
  status           Status     @default(TODO)
  priority         Priority   @default(MEDIUM)
  category         String?
  dueDate          DateTime?
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt

  company          Company    @relation(fields: [companyId], references: [id])
  companyId        Int
  
  supervisor       User       @relation("SupervisorTasks", fields: [supervisorId], references: [id])
  supervisorId     Int
  intern           User?      @relation("InternTasks", fields: [internId], references: [id])
  internId         Int?
}

// --- Evaluation Model (No change needed) ---
model Evaluation {
  id                  Int      @id @default(autoincrement())
  comments            String?
  technicalScore      Int?
  communicationScore  Int?
  teamworkScore       Int?
  submittedAt         DateTime @default(now())

  company             Company  @relation(fields: [companyId], references: [id])
  companyId           Int
  intern              User     @relation("InternEvals", fields: [internId], references: [id])
  internId            Int
  supervisor          User     @relation("SupervisorEvals", fields: [supervisorId], references: [id])
  supervisorId        Int
}

// --- Enums (Updated) ---

enum Role {
  ADMIN
  SUPERVISOR
  INTERN
}

enum Status {
  TODO
  IN_PROGRESS
  COMPLETED
  PENDING
  APPROVED
}

enum Priority {
  HIGH
  MEDIUM
  LOW
}